import{C as Y,p as U,a as B,b as G,L as F,c as j,d as P,P as H,e as K}from"./index-0cc4ea83.js";import{a as T,L as z,M as W,N as q,O as J}from"./urls-dc95fcef.js";import{U as Q}from"./util-75dcb7cf.js";import{_ as X,r as g,o as D,c as L,a as d,e as c,w as _,n as b,t as Z,j as E,d as R,h as v,p as $,g as tt}from"./index-e96a63ea.js";import"./axios-c24e582b.js";import"./apiService-77935b08.js";import"./urls-04ad3523.js";import"./auth-eef4144a.js";Y.register(U,B,G,F,j,P,H);const et={components:{LineChartGenerator:K},watch:{schoolId(s){if(s!="all"){T.post(z,{schoolId:s},n=>{this.teachers=[{title:"선생님 전체",value:"all"}];for(const a of n.list)this.teachers.push({title:a.name,value:a.uid,gclass:a.gclass,grade:a.grade});this.teacherId="all",this.students=[{title:"학생 전체",value:"all"}],this.uid="all"});const t=this.schools.filter(n=>n.value===this.schoolId);this.schoolName=t[0].title}else this.teachers=[{title:"선생님 전체",value:"all"}],this.teacherId="all",this.students=[{title:"학생 전체",value:"all"}],this.uid="all"},teacherId(s){if(s!="all"){let t="",n="";for(const e of this.teachers)s==e.value&&(t=e.gclass,n=e.grade);if(!t||!n)return;T.post(W,{schoolId:this.schoolId,gclass:t,grade:n},e=>{this.students=[{title:"학생 전체",value:"all"}];for(const h of e.list)this.students.push({title:h.name,value:h.uid});this.uid="all"});const a=this.teachers.filter(e=>e.value===this.teacherId);this.teacherName=a[0].title}else this.students=[{title:"학생 전체",value:"all"}],this.uid="all"}},data(){return{util:Q,chartData:{labels:[],datasets:[]},chartOptions:{responsive:!0,maintainAspectRatio:!1},chartShow:!1,height:300,dateClass:{year:"",month:"",day:"active"},dateType:"day",stdate:"",endate:"",stmonth:"",enmonth:"",menu1:!1,menu2:!1,yearList:[],styear:"",enyear:"",dayList:[],label:"",schools:[{title:"학교 전체",value:"all"}],schoolId:"all",schoolName:"",teachers:[{title:"선생님 전체",value:"all"}],teacherId:"all",teacherName:"",students:[{title:"학생 전체",value:"all"}],uid:"all",roleClass:{school:"active",teacher:"",member:""},userRole:"school"}},created(){this.setInit()},methods:{setRole(s){this.userRole=s,this.roleClass={school:"",teacher:"",member:""},this.roleClass[s]="active",this.getData()},setInit(){const s=new Date,t=s.getFullYear(),n=s.getDate()<10?"0"+s.getDate():s.getDate();for(let y=t;y>=2010;y--)this.yearList.push({title:y+"년",value:y});this.styear=t-5,this.enyear=s.getFullYear();let a=parseInt(s.getMonth())+1;a<10&&(a="0"+a);const e=new Date(t,parseInt(s.getMonth()-1),s.getDate()),m=new Date(t,s.getMonth(),0).getDate();let i=parseInt(e.getMonth())+1;i<10&&(i="0"+i);const r=s.getDate()>m?m:n;this.stmonth=e.getFullYear()+"-"+i,this.enmonth=t+"-"+a,this.stdate=t+"-"+i+"-"+r,this.endate=t+"-"+a+"-"+n,this.getInitData()},getInitData(){if(!this.setDateList())return;this.chartShow=!1;let s="",t="";const n={dateType:this.dateType,styear:this.styear.toString(),enyear:this.enyear.toString(),stmonth:this.stmonth.toString(),enmonth:this.enmonth.toString(),stdate:this.stdate.toString(),endate:this.endate.toString(),schoolId:this.schoolId,teacherId:this.teacherId,gclass:s,grade:t,uid:this.uid,userRole:this.userRole};switch(this.dateType){case"day":this.label="["+this.stdate+" ~ "+this.endate+"]";break;case"month":this.label="["+this.stmonth+" ~ "+this.enmonth+"]";break;case"year":this.label="["+this.styear+" ~ "+this.enyear+"]";break}T.post(q,n,a=>{for(const e of a.schoolList)e.school&&this.schools.push({title:e.school,value:e.schoolId});this.setGraph(a)})},getData(){if(!this.setDateList())return;this.chartShow=!1;let s="",t="";if(this.teacherId!="all")for(const a of this.teachers)this.teacherId==a.value&&(s=a.gclass.toString(),t=a.grade.toString());const n={dateType:this.dateType,styear:this.styear.toString(),enyear:this.enyear.toString(),stmonth:this.stmonth.toString(),enmonth:this.enmonth.toString(),stdate:this.stdate.toString(),endate:this.endate.toString(),schoolId:this.schoolId,teacherId:this.teacherId,gclass:s,grade:t,uid:this.uid,userRole:this.userRole};switch(this.dateType){case"day":this.label="["+this.stdate+" ~ "+this.endate+"]";break;case"month":this.label="["+this.stmonth+" ~ "+this.enmonth+"]";break;case"year":this.label="["+this.styear+" ~ "+this.enyear+"]";break}T.post(J,n,a=>{this.setGraph(a)})},setDateList(){let s,t,n=0,a=0,e="";switch(this.dateType){case"day":let h=this.stdate.split("-"),m=new Date(h[0],h[1]-1,h[2]),i=this.endate.split("-"),r=new Date(i[0],i[1]-1,i[2]);if(e=r.getTime()-m.getTime(),e<0){let l={message:"시작일은 종료일보다 같거나 작아야 합니다"};return this.emitter.emit("modalOpen",l),!1}if(this.dateType=="day"){if(Math.abs(e/864e5)>31){let p={message:"일별 통계는 기간 차이가 31일 이내여야 합니다 "};return this.emitter.emit("modalOpen",p),!1}this.dayList=[];let u=m.getFullYear(),I=r.getFullYear(),C=m.getMonth()+1,S=r.getMonth()+1;s=new Date(h[0],h[1],0).getDate();let M=m.getDate(),O=r.getDate();if(C!=S){for(let p=M;p<=s;p++){let k=p<10?"0"+p:p,w=C<10?"0"+C:C;this.dayList.push({keyDate:w+"/"+k,viewDate:u+"."+w+"."+k})}M=1}for(let p=M;p<=O;p++){let k=p<10?"0"+p:p,w=S<10?"0"+S:S;this.dayList.push({keyDate:w+"/"+k,viewDate:I+"."+w+"."+k})}}else{this.dayList=[];let l=["일","월","화","수","목","금","토"];for(let u=0;u<=6;u++)this.dayList.push(l[u])}break;case"month":if(n=parseInt(this.stmonth.replace("-","")),a=parseInt(this.enmonth.replace("-","")),e=a-n,e<0){let l={message:"시작일은 종료일보다 같거나 작아야 합니다"};return this.emitter.emit("modalOpen",l),!1}let y=this.stmonth.split("-"),x=this.enmonth.split("-"),f=parseInt(y[0]),V=parseInt(x[0]),o=parseInt(y[1]),A=parseInt(x[1]);if(this.dayList=[],e>=99){this.monthAllView=!0;for(let l=1;l<=12;l++){let u=l<10?"0"+l:l;this.dayList.push(u)}}else{if(this.monthAllView=!1,f!=V){for(let l=o;l<=12;l++){let u=l<10?"0"+l:l,I=f<10?"0"+f:f;this.dayList.push(I+"/"+u)}o=1}for(let l=o;l<=A;l++){let u=l<10?"0"+l:l,I=f<10?"0"+f:f;this.dayList.push(I+"/"+u)}}break;case"year":if(parseInt(this.styear)>parseInt(this.enyear)){let l={message:"시작일은 종료일보다 같거나 작아야 합니다"};return this.emitter.emit("modalOpen",l),!1}s=this.enyear,t=this.styear,this.dayList=[];for(let l=t;l<=s;l++){let u=l<10?"0"+l:l;this.dayList.push(u)}break}return!0},setDateType(s){this.dateType=s;for(const t in this.dateClass)t==s?this.dateClass[t]="active":this.dateClass[t]=""},search(){this.getData()},setDateText(s){let t="";switch(this.dateType){case"month":t=s.replace("/",".");break;default:t=s;break}return t},setGraph(s){const t=s.data.date.buckets;this.chartData.labels=[];const n={};let a="";for(const r of t)a=this.getIndexDateKey(r.key),r.aggregations&&(n[a]=r.aggregations.asMap.uidTotal.value);let e=[],h="";const m=[];for(const r of this.dayList)this.dateType=="day"?(h=r.keyDate,m.push(r.keyDate)):(h=r,m.push(r)),n[h]?e.push(n[h]):e.push(0);this.chartData.labels=m;let i="학생 전체";switch(this.userRole){case"school":this.schoolId=="all"?i="학교 전체":i=this.schoolName;break;case"teacher":this.teacherId=="all"?this.schoolId=="all"?i="선생님 전체":i=this.schoolName+" 선생님 전체":i=this.teacherName;break;case"member":this.uid=="all"?this.schoolId=="all"?i="학생 전체":this.teacherId=="all"?i=this.schoolName+" 학생 전체":i=this.teacherName+"반 학생 전체":i=this.students.filter(y=>y.value===this.uid)[0].title;break}this.chartData.datasets=[{label:i,backgroundColor:"#00D8FF",data:e}],this.chartShow=!0},getIndexDateKey(s){let t;const a=s.split("T")[0];switch(this.dateType){case"day":return t=a.split("-"),t[1]+"/"+t[2];case"month":return console.log(this.monthAllView),t=a.split("-"),t[0]+"/"+t[1];case"year":return t=a.split("-"),t[0]}}}},N=s=>($("data-v-24516f83"),s=s(),tt(),s),st={class:"page-container"},at={class:"product-container"},lt={style:{display:"flex"}},it={style:{width:"200px","margin-right":"10px"}},ot={style:{width:"200px","margin-right":"10px"}},nt={style:{width:"200px","margin-right":"10px"}},ht={style:{display:"flex","justify-content":"space-between"}},rt={style:{display:"flex"}},dt={class:"date-box"},ct={key:0,class:"month-box"},mt={class:"day-item"},ut=N(()=>d("div",{class:"term"}," ~",-1)),pt={class:"day-item"},yt={key:1,class:"month-box"},ft=N(()=>d("div",{class:"term"}," ~",-1)),gt={key:2,class:"year-box"},_t=N(()=>d("span",null," ~ ",-1)),vt={class:"button-box"},Dt={class:"graph-box"},bt={class:"graph-title",style:{display:"flex","padding-top":"20px","margin-bottom":"40px"}},It={class:"date"},kt={style:{margin:"-10px 0 0 50px"}},wt={style:{"max-height":"700px",overflow:"auto"}};function xt(s,t,n,a,e,h){const m=g("v-autocomplete"),i=g("v-btn"),r=g("v-text-field"),y=g("v-select"),x=g("font-awesome-icon"),f=g("v-progress-circular"),V=g("LineChartGenerator");return D(),L("div",st,[d("div",at,[d("div",lt,[d("div",it,[c(m,{variant:"outlined",density:"compact",label:"학교명",items:e.schools,modelValue:e.schoolId,"onUpdate:modelValue":t[0]||(t[0]=o=>e.schoolId=o)},null,8,["items","modelValue"])]),d("div",ot,[c(m,{variant:"outlined",density:"compact",label:"선생님이름",items:e.teachers,modelValue:e.teacherId,"onUpdate:modelValue":t[1]||(t[1]=o=>e.teacherId=o)},null,8,["items","modelValue"])]),d("div",nt,[c(m,{variant:"outlined",density:"compact",label:"학생이름",items:e.students,modelValue:e.uid,"onUpdate:modelValue":t[2]||(t[2]=o=>e.uid=o)},null,8,["items","modelValue"])])]),d("div",ht,[d("div",rt,[d("div",dt,[c(i,{variant:"outlined",class:b("white-button "+e.dateClass.day),onClick:t[3]||(t[3]=o=>h.setDateType("day"))},{default:_(()=>[v(" 일간 ")]),_:1},8,["class"]),c(i,{variant:"outlined",class:b("white-button "+e.dateClass.month),onClick:t[4]||(t[4]=o=>h.setDateType("month"))},{default:_(()=>[v("월간 ")]),_:1},8,["class"]),c(i,{variant:"outlined",class:b("white-button "+e.dateClass.year),onClick:t[5]||(t[5]=o=>h.setDateType("year"))},{default:_(()=>[v(" 연간 ")]),_:1},8,["class"])]),e.dateClass.day=="active"||e.dateClass.week=="active"?(D(),L("div",ct,[d("div",mt,[c(r,{modelValue:e.stdate,"onUpdate:modelValue":t[6]||(t[6]=o=>e.stdate=o),class:"day-item",variant:"outlined",density:"compact",type:"date"},null,8,["modelValue"])]),ut,d("div",pt,[c(r,{modelValue:e.endate,"onUpdate:modelValue":t[7]||(t[7]=o=>e.endate=o),class:"day-item",variant:"outlined",type:"date",density:"compact"},null,8,["modelValue"])])])):e.dateClass.month=="active"?(D(),L("div",yt,[d("div",null,[c(r,{modelValue:e.stmonth,"onUpdate:modelValue":t[8]||(t[8]=o=>e.stmonth=o),variant:"outlined",density:"compact",style:{"max-width":"130px",width:"130px"},suffix:"월"},null,8,["modelValue"])]),ft,d("div",null,[c(r,{modelValue:e.enmonth,"onUpdate:modelValue":t[9]||(t[9]=o=>e.enmonth=o),variant:"outlined",density:"compact",style:{"max-width":"130px",width:"130px"},suffix:"월"},null,8,["modelValue"])])])):(D(),L("div",gt,[c(y,{class:"year-item",modelValue:e.styear,"onUpdate:modelValue":t[10]||(t[10]=o=>e.styear=o),variant:"outlined",density:"compact",items:e.yearList},null,8,["modelValue","items"]),_t,c(y,{class:"year-item",variant:"outlined",density:"compact",modelValue:e.enyear,"onUpdate:modelValue":t[11]||(t[11]=o=>e.enyear=o),items:e.yearList},null,8,["modelValue","items"])])),d("div",vt,[c(i,{depressed:"",class:"white-button submit-button",onClick:t[12]||(t[12]=o=>h.search())},{default:_(()=>[c(x,{icon:"fa-solid fa-magnifying-glass",style:{"margin-right":"6px"}}),v(" 검색 ")]),_:1})])])]),d("div",Dt,[d("div",bt,[d("span",It,Z(e.label),1),d("div",kt,[c(i,{variant:"outlined",class:b("white-button "+e.roleClass.school),onClick:t[13]||(t[13]=o=>h.setRole("school"))},{default:_(()=>[v(" 학교 ")]),_:1},8,["class"]),c(i,{variant:"outlined",class:b("white-button "+e.roleClass.teacher),onClick:t[14]||(t[14]=o=>h.setRole("teacher"))},{default:_(()=>[v(" 선생님 ")]),_:1},8,["class"]),c(i,{variant:"outlined",class:b("white-button "+e.roleClass.member),onClick:t[15]||(t[15]=o=>h.setRole("member"))},{default:_(()=>[v("학생 ")]),_:1},8,["class"])])]),e.chartShow?R("",!0):(D(),E(f,{key:0,size:100,class:"progress-box",color:"#DD1B16",indeterminate:""})),d("div",wt,[e.chartShow?(D(),E(V,{key:0,options:e.chartOptions,data:e.chartData,height:"500"},null,8,["options","data"])):R("",!0)])])])])}const At=X(et,[["render",xt],["__scopeId","data-v-24516f83"]]);export{At as default};
