import{a as S}from"./apiService-77935b08.js";import{U as v}from"./util-75dcb7cf.js";import{y as w,z as C}from"./urls-04ad3523.js";import{A as N}from"./auth-eef4144a.js";import"./jquery-d8551b6e.js";import{w as L}from"./realTimeEdu-31352dc5.js";import{_ as T,m as I,r as b,o as c,c as h,a as s,e as u,w as p,i as U,h as k,t as _,F as y,b as D,d as x,n as V,p as M,g as E}from"./index-e96a63ea.js";import{_ as F}from"./btn_copy-851c0c0c.js";import{_ as B}from"./img_bot-69f44715.js";import"./axios-c24e582b.js";const P={computed:{...I(L,["prohibitList"])},watch:{claDate(e){this.checkNowDate(e)}},data(){return{claDate:"",claTime:"",claName:"",form:null,viewStudent:"전체",selStudents:[],memberDialog:!1,students:[],id:"",tempEduProblemList:[],nextUrl:"/edu/create",nextUrlByList:"/edu/createByList",botMessage:"왼쪽의 교육 만들기 창에서<br> 기본 정보 입력을 마치면<br> 상세 내용을 확인하실 수 있습니다",inviteLink:"",inviteCode:"",claTimeMessage:"수업 시간을 입력하세요",prohibitFlag:!1}},created(){this.$isMobile()&&(this.claTimeMessage="수업 시간 입력"),this.$route.params.id&&(this.id=this.$route.params.id,this.nextUrl="/edu/modify/"+this.id,this.nextUrlByList="/edu/modifyByList/"+this.id);const e=N.getSession();(!e||!e.memberInfo||!e.memberInfo.payEndDate)&&(location.href="/"),this.getData()},methods:{getData(){S.post(w,{id:this.id},e=>{if(e.students)for(const t of e.students)this.students.push({uid:t.uid,name:t.name,active:""});if(sessionStorage.getItem("tempEduForm")){const t=JSON.parse(sessionStorage.getItem("tempEduForm")),a=v.getTimeFormat(t.claDate);this.claDate=a,this.claTime=t.claTime,this.claName=t.claName,this.inviteCode=t.inviteCode,this.inviteLink="https://"+location.host+"/joinEdu/"+this.inviteCode;const n=[],i=JSON.parse(t.selStudents);if(this.students.length!=i.length)for(let d of i)this.students.filter(r=>{r.uid==d.uid&&(r.active="active")}),this.selStudents.push(d),n.push(d.name);this.viewStudent=n.length>0?n.join(","):"전체"}else if(this.id&&e.eduInfo){const t=v.getTimeFormat(e.eduInfo.claDate);this.claDate=t,this.claTime=e.eduInfo.claTime,this.claName=e.eduInfo.claName,e.eduInfo.extraVars&&(this.inviteCode=e.eduInfo.extraVars.inviteCode,this.inviteLink="https://"+location.host+"/joinEdu/"+this.inviteCode);const a=[],n=JSON.parse(e.eduInfo.selStudents);if(this.students.length!=n.length)for(let i of n)this.students.filter(d=>{d.uid==i.uid&&(d.active="active")}),this.selStudents.push(i),a.push(i.name);this.viewStudent=a.length>0?a.join(","):"전체"}else{const t=new Date,a=Math.floor(Math.random()*(9999-1e3))+1e3;this.inviteCode=t.getTime()+""+a,this.inviteLink="https://"+location.host+"/joinEdu/"+this.inviteCode}if(this.id&&e.eduInfo)for(const t of e.isProblemList){let a=t.source;a.id=t.id,this.tempEduProblemList.push(a)}})},setCopy(){this.$copyText(this.inviteLink).then(()=>{const e={message:"초대 링크를 복사하였습니다"};this.emitter.emit("modalOpen",e)})},checkTime(e){return isNaN(e)?this.$isMobile()?"숫자만 입력가능":"수업 시간은 숫자만 입력가능합니다":e?!0:this.claTimeMessage},selectStudent(e){let t=!1,a=0,n=0;for(const i of this.selStudents){if(i.uid==e.uid){t=!0,n=a;break}a++}if(t)this.selStudents.splice(n,1);else{const i={uid:e.uid,name:e.name};this.selStudents.push(i)}for(let i of this.students)if(i.uid==e.uid){i.active=i.active?"":"active";break}},studentSetting(){const e=[];for(const t of this.selStudents)e.push(t.name);this.viewStudent=e.length>0?e.join(","):"전체",this.memberDialog=!1},studentShow(){this.memberDialog=!0},checkNowDate(e){if(e){const t=new Date,a=t.getFullYear();let n=t.getMonth()+1;n=n>9?n:"0"+n;const i=t.getDate()>9?t.getDate():"0"+t.getDate();let d=a.toString()+n.toString()+i.toString();const r=e.split("-"),m=r[0].toString()+r[1].toString()+r[2].toString();if(parseInt(m)<parseInt(d)){const f={message:"수업 일자는 오늘날짜보다 크거나 같아야 합니다",doAction:()=>{this.claDate=a.toString()+"-"+n.toString()+"-"+i.toString()}};this.emitter.emit("modalOpen",f)}}},checkProhibit(){if(!this.claName)return this.prohibitFlag=!1,!1;if(v.checkProhibitByWord(this.claName,this.prohibitList))return this.prohibitFlag=!0,!0;{let t={message:"존중과 예의를 기반으로,<br>긍정적인 언어를 사용해주세요."};return this.emitter.emit("modalOpen",t),this.prohibitFlag=!1,!1}},validate(){if(this.form){if(!this.checkProhibit())return;const e=[];if(this.selStudents.length<1)for(let n of this.students){let i={uid:n.uid,name:n.name};e.push(i)}else for(const n of this.selStudents)e.push(n);this.checkNowDate(this.claDate);const a={claDate:new Date(this.claDate).getTime(),claTime:this.claTime,claName:this.claName,inviteCode:this.inviteCode,selStudents:JSON.stringify(e)};sessionStorage.setItem("tempEduForm",JSON.stringify(a))}},eduNewMake(){this.form&&this.checkProhibit()&&this.$router.push(this.nextUrl)},eduNewMakeWithBaseList(){this.form&&this.checkProhibit()&&this.$router.push(this.nextUrlByList)},eduNewMakeUpdate(){this.validate(),this.form&&this.prohibitFlag&&this.$router.push(this.nextUrl)},eduNewMakeWithBaseListUpdate(){this.validate(),this.form&&this.prohibitFlag&&this.$router.push(this.nextUrlByList)},updateEduInfo(){if(this.validate(),this.form&&this.id&&this.prohibitFlag){let e=JSON.parse(sessionStorage.getItem("tempEduForm"));e.id=this.id,this.emitter.emit("overlay","open"),S.post(C,e,t=>{this.emitter.emit("overlay","hide");const a={message:"교육정보가 수정 되었습니다",doAction:()=>{location.href="/edu/createList"}};this.emitter.emit("modalOpen",a)})}}},mounted(){}},l=e=>(M("data-v-a44dd7dc"),e=e(),E(),e),O={class:"edu-layout"},j={class:"left-container"},A=l(()=>s("div",{class:"sub-title"},"교육 만들기",-1)),J={class:"input-ul"},W=l(()=>s("div",{class:"label"},"수업 일자",-1)),H=l(()=>s("div",{class:"label"},"수업 시간",-1)),z=l(()=>s("div",{class:"min"},"분",-1)),R=l(()=>s("div",{class:"label"},"초대 링크",-1)),G=l(()=>s("img",{src:F},null,-1)),Y=[G],q=l(()=>s("div",{class:"label"},"학생",-1)),K=l(()=>s("span",null,"선택",-1)),Q=l(()=>s("div",{class:"label"},"교육명",-1)),X={key:0,class:"button-row"},Z=l(()=>s("span",null,"취소",-1)),$=l(()=>s("span",null,"저장",-1)),tt={key:1,class:"button-row"},et=l(()=>s("span",null,"새로 만들기",-1)),st=l(()=>s("span",null,"기존 교육에서 고르기",-1)),it=l(()=>s("div",{class:"blank-container"},null,-1)),ot={class:"right-container"},nt={key:0},lt=l(()=>s("div",{class:"right-title"},"수업인원 설정",-1)),at={class:"total"},dt={class:"right-ul"},ut={class:"name-box"},rt={class:"first-name"},ct={class:"full-name"},ht=l(()=>s("span",null,"선택",-1)),mt=l(()=>s("span",null,"완료",-1)),pt={key:1},_t={key:0},ft=l(()=>s("div",{class:"right-edu-title"},"담은 교육 목록",-1)),vt={key:0,class:"sub-body"},bt={class:"table-box"},gt={class:"edu-table",cellspacing:"0",cellpadding:"0",border:"0"},St=l(()=>s("thead",null,[s("tr",null,[s("th",{class:"sm-tblet",style:{width:"80px"}},"순번"),s("th",null,"교육명")])],-1)),kt={class:"sm-tblet"},yt={class:"subject-box"},Dt={class:"subject"},wt={class:"button-row"},Ct=l(()=>s("span",null,"새로 만들기",-1)),Nt=l(()=>s("span",null,"기존 교육에서 고르기",-1)),Lt={key:1,class:"bot-box"},Tt=l(()=>s("img",{src:B},null,-1)),It=["innerHTML"];function Ut(e,t,a,n,i,d){const r=b("v-text-field"),m=b("v-btn"),f=b("v-form");return c(),h("div",O,[s("div",j,[A,u(f,{modelValue:i.form,"onUpdate:modelValue":t[8]||(t[8]=o=>i.form=o),novalidate:"",onSubmit:U(d.validate,["prevent"])},{default:p(()=>[s("ul",J,[s("li",null,[W,u(r,{type:"date",variant:"outlined",modelValue:i.claDate,"onUpdate:modelValue":t[0]||(t[0]=o=>i.claDate=o),rules:[o=>!!o||"수업 일자를 입력하세요"],density:"compact",placeholder:"수업 일자를 입력하세요"},null,8,["modelValue","rules"])]),s("li",null,[H,u(r,{variant:"outlined",modelValue:i.claTime,"onUpdate:modelValue":t[1]||(t[1]=o=>i.claTime=o),rules:[d.checkTime],density:"compact",placeholder:i.claTimeMessage},null,8,["modelValue","rules","placeholder"]),z]),s("li",null,[R,u(r,{readonly:!0,variant:"outlined",modelValue:i.inviteLink,"onUpdate:modelValue":t[2]||(t[2]=o=>i.inviteLink=o),density:"compact"},null,8,["modelValue"]),s("div",{class:"copy-icon",onClick:t[3]||(t[3]=o=>d.setCopy())},Y)]),s("li",null,[q,u(r,{readonly:!0,variant:"outlined",density:"compact",rules:[o=>!!o||"학생을 입력하세요"],onClick:d.studentShow,modelValue:i.viewStudent,"onUpdate:modelValue":t[4]||(t[4]=o=>i.viewStudent=o)},null,8,["rules","onClick","modelValue"]),u(m,{type:"button",class:"memSelButton",variant:"outlined",onClick:d.studentShow},{default:p(()=>[K]),_:1},8,["onClick"])]),s("li",null,[Q,u(r,{variant:"outlined",density:"compact",rules:[o=>!!o||"교육명을 입력하세요"],modelValue:i.claName,"onUpdate:modelValue":t[5]||(t[5]=o=>i.claName=o)},null,8,["rules","modelValue"])])]),i.id?(c(),h("div",X,[u(m,{type:"button",class:"back-button",variant:"tonal",onClick:t[6]||(t[6]=o=>e.$router.back())},{default:p(()=>[Z]),_:1}),u(m,{type:"button",class:"left-button",variant:"tonal",onClick:t[7]||(t[7]=o=>d.updateEduInfo())},{default:p(()=>[$]),_:1})])):(c(),h("div",tt,[u(m,{type:"submit",class:"left-button",variant:"tonal",onClick:d.eduNewMake},{default:p(()=>[et]),_:1},8,["onClick"]),u(m,{type:"submit",class:"left-button",variant:"tonal",onClick:d.eduNewMakeWithBaseList},{default:p(()=>[st]),_:1},8,["onClick"])]))]),_:1},8,["modelValue","onSubmit"])]),it,s("div",ot,[i.memberDialog?(c(),h("div",nt,[lt,s("div",at,[k("총 "),s("span",null,_(i.students.length),1),k(" 명")]),s("ul",dt,[(c(!0),h(y,null,D(i.students,o=>(c(),h("li",null,[s("div",ut,[s("div",rt,_(o.name.substring(0,1)),1),s("div",ct,_(o.name),1)]),u(m,{type:"button",class:V("memSelButton "+o.active),color:"#DCDCDC",variant:"outlined",onClick:g=>d.selectStudent(o)},{default:p(()=>[ht]),_:2},1032,["class","onClick"])]))),256))]),u(m,{type:"button",variant:"tonal",class:"right-button",onClick:d.studentSetting},{default:p(()=>[mt]),_:1},8,["onClick"])])):(c(),h("div",pt,[i.id?(c(),h("div",_t,[ft,i.tempEduProblemList.length>0?(c(),h("div",vt,[s("div",bt,[s("table",gt,[St,s("tbody",null,[(c(!0),h(y,null,D(i.tempEduProblemList,(o,g)=>(c(),h("tr",null,[s("td",kt,_(g+1),1),s("td",yt,[s("div",Dt,_(o.subject),1)])]))),256))])])])])):x("",!0),s("div",wt,[u(m,{type:"button",class:"left-button",variant:"tonal",onClick:t[9]||(t[9]=o=>d.eduNewMakeUpdate())},{default:p(()=>[Ct]),_:1}),u(m,{type:"button",class:"left-button",variant:"tonal",onClick:t[10]||(t[10]=o=>d.eduNewMakeWithBaseListUpdate())},{default:p(()=>[Nt]),_:1})])])):(c(),h("div",Lt,[Tt,s("div",{class:"bot-message",innerHTML:i.botMessage},null,8,It)]))]))])])}const Jt=T(P,[["render",Ut],["__scopeId","data-v-a44dd7dc"]]);export{Jt as default};
