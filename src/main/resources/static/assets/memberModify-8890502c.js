import{a as g}from"./apiService-77935b08.js";import{T as R,U as F,A as w,f as P,g as S,V as C,W as M,X as L}from"./urls-04ad3523.js";import{A as E}from"./auth-eef4144a.js";import{U as x}from"./util-75dcb7cf.js";import{_ as B,r as f,o as r,c as u,a as i,e as h,w as v,i as G,F as y,b,n as U,t as _,d as p,j as N,h as I,k as V,J as A,p as D,g as j}from"./index-e96a63ea.js";import"./axios-c24e582b.js";const H={watch:{city(t){this.firstFlag?this.firstFlag=!1:(this.emitter.emit("overlay","open"),this.serverFlag=!0,this.school="",this.schools=[],this.schoolDatas=[]),g.post(R,{city:t},e=>{if(this.serverFlag=!1,this.emitter.emit("overlay","hide"),e.list)for(const o of e.list)this.schoolDatas.push(o),this.schools.push(o.name)})},role(t){switch(t){case"ROLE_MEMBER":this.joinTypeText="학생",this.viewName="이름",this.viewPcs="연락처";break;case"ROLE_TEACHER":this.joinTypeText="선생님",this.viewName="이름",this.viewPcs="연락처";break;case"ROLE_MANAGER":this.joinTypeText="학교",this.viewName="이름",this.viewPcs="연락처";break}}},data(){return{roleList:[{role:"ROLE_MEMBER",name:"학생",active:""},{role:"ROLE_TEACHER",name:"선생님",active:""},{role:"ROLE_MANAGER",name:"학교",active:""}],serverFlag:!1,form:null,uid:"",viewName:"이름",name:"",viewPcs:"연락처",pcs:"",city:"지역선택",citys:["서울","광주","부산","인천","대구","대전","울산","세종","경기","강원","제주","전남","전북","충남","충북","경남","경북"],school:"",schools:[],schoolDatas:[],grade:"",gclass:"",role:"",teacherName:"",email:"",upassErrorFlag:!1,joinTypeText:"",firstFlag:!1,nowupass:"",upass:"",reUpass:"",authNum:"",authTimerOut:!0,authTimer:"",sendAuthFlag:!1,timeInterval:null,authActive:!1,orgPcs:"",userType:"teacher",oPcs:"",oUserName:"",snsType:"",snsName:"",userFirstName:"",userImg:"",userImgClass:"",uploadImg:null,schoolReadOnly:!1,safariV13:!1}},created(){const t=E.getSession();if(!t||!(t!=null&&t.memberInfo)){this.$router.push("/");return}this.safariV13=x.checkSafari(),this.getData()},methods:{getData(){this.serverFlag=!0,g.post(F,{},t=>{this.serverFlag=!1;const e=t.memberInfo;if(this.uid=e.uid,this.email=e.email,this.role=e.role,this.name=e.name,this.role=="ROLE_MANAGER"&&(this.schoolReadOnly=!0),this.userFirstName=e.name.substring(0,1),e.img&&(this.userImg=w+"?imgName="+e.img,this.userImgClass="nonebg"),this.snsType=e.snsType!="none"?e.snsType:"",this.snsType)switch(this.snsType){case"nv":this.snsName="네이버";break;case"ka":this.snsName="카카오";break;case"gl":this.snsName="구글";break}this.orgPcs=e.pcs,this.pcs=e.pcs,this.grade=parseInt(e.grade),this.gclass=parseInt(e.gclass),this.teacherName=e.teacherName,this.userType=e.suserType,this.oPcs=e.oPcs,this.oUserName=e.oUserName,this.getSchoolArea(e)})},checkGrade(t){return isNaN(t)&&(this.grade=""),t?(t.length>1&&(this.grade=t.substring(0,1)),!0):"학년을 입력하세요"},checkGclass(t){return isNaN(t)&&(this.gclass=""),t?(t.length>2&&(this.gclass=t.substring(0,2)),!0):"반을 입력하세요"},upassErrors(t){if(this.upassErrorFlag=!1,!t)return!0;if(t.length<6||t.length>20)return"비밀번호는 6~20자 사이로 입력하세요";let e=/\d{1}/,o=e.test(t);return o?(e=/[a-zA-Z]/,o=e.test(t),o?(e=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/,o=e.test(t),o?(this.upassErrorFlag=!0,"비밀번호에 한글을 사용할수 없습니다"):!0):(this.upassErrorFlag=!0,"비밀번호는 영문을 포함해야 합니다")):(this.upassErrorFlag=!0,"비밀번호는 한개이상의 숫자를 포함해야 합니다")},reUpassErrors(t){return this.upassErrorFlag=!1,t?this.upass!=t?(this.upassErrorFlag=!0,"새 비밀번호와 새 비밀번호 확인이 다릅니다"):!0:"비밀번호를 다시 입력하세요"},authNumErrors(t){return t?!0:"인증번호를 입력하세요"},sendAuthNum(){if(!this.pcs){this.emitter.emit("modalOpen",{message:"연락처를 입력하세요"});return}if(isNaN(this.pcs)){this.emitter.emit("modalOpen",{message:"잘못된 연락처형식 입니다"});return}if(this.pcs.length>11){this.emitter.emit("modalOpen",{message:"잘못된 연락처형식 입니다"});return}this.emitter.emit("overlay","open"),this.serverFlag=!0,g.post(P,{pcs:this.pcs.toString()},t=>{this.serverFlag=!1,this.emitter.emit("overlay","hide");let e=t.status,o={};this.authTimerOut=!0,e=="success"?(o={message:"인증번호를 발송하였습니다"},this.setTime(),this.sendAuthFlag=!0):(this.sendAuthFlag=!1,o={message:"인증번호를 발송에 실패하였습니다"}),this.emitter.emit("modalOpen",o)})},checkAuthNum(){if(!this.authActive){this.emitter.emit("modalOpen",{message:"인증만료시간이 경과되었습니다"});return}if(!this.pcs){this.emitter.emit("modalOpen",{message:"연락처를 입력하세요"});return}this.emitter.emit("overlay","open"),this.serverFlag=!0,g.post(S,{pcs:this.pcs.toString(),authNumber:this.authNum},t=>{this.serverFlag=!1,this.emitter.emit("overlay","hide");let e=t.status,o={};e=="success"?(this.authPcs=this.pcs,this.timeInterval&&clearInterval(this.timeInterval),o={message:"인증번호를 확인하였습니다"}):(this.authPcs="",o={message:"잘못된 인증번호 입니다"}),this.emitter.emit("modalOpen",o)})},setTime(){this.timeInterval&&clearInterval(this.timeInterval);let t=180;this.authTimer="3:00",this.authActive=!0,this.timeInterval=setInterval(()=>{if(t--,t<1)this.authActive=!1,clearInterval(this.timeInterval);else{const e=parseInt(t/60);let o=t%60;o<10&&(o="0"+o),this.authTimer=e+":"+o}},1e3)},getSchoolArea(t){this.serverFlag=!0,g.post(C,{schoolId:t.schoolId.toString()},e=>{this.serverFlag=!1,this.firstFlag=!0,this.city=e.info.city,this.school=t.school})},checkCity(){if(this.city=="지역선택"){const t={message:"먼저 지역을 선택하세요"};this.emitter.emit("modalOpen",t)}},pcsErrors(t){return t?isNaN(t)?"연락처는 숫자만 입력가능합니다":(t.length>11&&(this.pcs=t.substring(0,11)),!0):this.viewPcs+"를 입력하세요"},validate(){if(this.serverFlag||!this.form)return;if(this.pcs!=this.orgPcs){if(!this.authPcs){let d={message:"연락처 인증을 완료해주세요"};this.emitter.emit("modalOpen",d);return}if(this.authPcs!=this.pcs){let d={message:"인증받은 연락처와 현재 연락처가 다릅니다"};this.emitter.emit("modalOpen",d);return}}if(this.safariV13&&!this.school){let d={message:"학교를 선택하세요"};this.emitter.emit("modalOpen",d);return}const e=this.schoolDatas.filter(d=>d.name==this.school)[0].id,o={name:this.name,pcs:this.pcs,schoolId:e,school:this.school,nowupass:this.nowupass,upass:this.upass,grade:this.grade,gclass:this.gclass,teacherName:this.teacherName,sUserType:this.userType,oPcs:this.oPcs,oUserName:this.oUserName};this.emitter.emit("overlay","open"),this.serverFlag=!0,g.post(M,o,d=>{let s=d.status,a={};if(s=="success"){let m=E.getSession().memberInfo;m.name=this.name,m.pcs=this.pcs,m.schoolId=e,m.school=this.school,m.grade=this.grade,m.gclass=this.gclass,m.teacherName=this.teacherName,m.sUserType=this.userType,m.oPcs=this.oPcs,m.oUserName=this.oUserName,this.uploadImg?this.updateUploadImg(m):(sessionStorage.setItem("memberInfo",JSON.stringify(m)),this.serverFlag=!1,this.emitter.emit("overlay","hide"),a={message:"계정정보가 변경 되었습니다",doAction:()=>{location.href="/"}},this.emitter.emit("modalOpen",a))}else{this.serverFlag=!1,this.emitter.emit("overlay","hide");let n="";switch(d.code){case"doubleSchool":n="중복된 학교 입니다";break;case"doubleTeacher":n="중복된 학교/학년/반 입니다";break;case"wrongNowUpass":n="잘못된 현재 비밀번호 입니다";break;default:n="잘못된 접근입니다";break}a={message:n},this.emitter.emit("modalOpen",a)}})},updateUploadImg(t){const e={image:this.uploadImg,type:"profile"};g.postFile(L,e,o=>{if(this.serverFlag=!1,this.emitter.emit("overlay","hide"),o.status=="success"){t.img=o.memImg,sessionStorage.setItem("memberInfo",JSON.stringify(t));const d={message:"계정정보가 변경 되었습니다",doAction:()=>{location.href="/"}};this.emitter.emit("modalOpen",d)}else this.emitter.emit("modalOpen",{message:"잘못된 이미지 입니다"})})},imgUpload(){this.$refs.fileupload.click()},async uploadActive(t){const e=t.target.files[0];this.uploadImg=e;const o=new FileReader;o.onload=d=>{this.userImg=d.target.result,this.userImgClass="nonebg"},o.readAsDataURL(e)}},mounted(){}},c=t=>(D("data-v-2fcb6e95"),t=t(),j(),t),J={class:"login-container"},z={class:"login-container-inner"},Y=c(()=>i("p",{class:"page-title"},"계정 정보",-1)),K={class:"input-ul"},W=c(()=>i("div",{class:"label"},"구분",-1)),X={class:"tab-box"},Z=c(()=>i("div",{class:"sub-title"},"개인정보 입력",-1)),q={class:"input-ul"},Q={key:0},$=c(()=>i("div",{class:"label"},"SNS 정보",-1)),ee={class:"text"},se=c(()=>i("div",{class:"label"},"이메일",-1)),te={class:"label"},le={class:"label"},ie={class:"auth-box"},oe=c(()=>i("span",null,"인증번호 전송",-1)),re={key:1},ae={class:"label"},ne={key:0,class:"auth-timer"},ue={class:"auth-box"},ce=c(()=>i("span",null,"인증번호 확인",-1)),me={key:2},he=c(()=>i("div",{class:"label"},"새 비밀번호 (비밀번호 변경 시에만 입력하세요)",-1)),de={key:3},pe=c(()=>i("div",{class:"label"},"새 비밀번호 확인",-1)),_e={key:4},ge=c(()=>i("div",{class:"label"},"현재 비밀번호",-1)),fe=c(()=>i("div",{class:"label"},"프로필 수정",-1)),ve=["src"],ye={key:1},be=c(()=>i("span",null,"이미지 선택",-1)),Ne=c(()=>i("div",{class:"sub-title"},"학교정보 입력",-1)),Ie={class:"input-ul"},Ee=c(()=>i("div",{class:"label"},"학교명",-1)),Ue={class:"school-box"},Ve={class:"city"},Ae=c(()=>i("option",{value:"지역선택"},"지역 선택",-1)),ke=["value"],Te={class:"school"},Oe=["readonly"],Re=c(()=>i("option",{value:""},"학교명 선택",-1)),Fe=["value"],we=c(()=>i("div",{class:"label"},"학년/반",-1)),Pe={class:"school-box"},Se={class:"city"},Ce={class:"school"},Me={key:0},Le=c(()=>i("div",{class:"label"},"정산 담당자",-1)),xe={class:"school-box"},Be={class:"city"},Ge={class:"school"},De={key:1},je=c(()=>i("div",{class:"label"},"담임선생님 이름",-1)),He={class:"button-row"};function Je(t,e,o,d,s,a){const n=f("v-text-field"),m=f("v-btn"),k=f("v-select"),T=f("v-autocomplete"),O=f("v-form");return r(),u("div",J,[i("div",z,[Y,h(O,{modelValue:s.form,"onUpdate:modelValue":e[20]||(e[20]=l=>s.form=l),novalidate:"",onSubmit:G(a.validate,["prevent"])},{default:v(()=>[i("ul",K,[i("li",null,[W,i("ul",X,[(r(!0),u(y,null,b(s.roleList,l=>(r(),u("li",{class:U("tab-li "+(l.role==s.role?"active":""))},_(l.name),3))),256))])])]),Z,i("ul",q,[s.snsType?(r(),u("li",Q,[$,i("div",ee,_(s.snsName),1)])):p("",!0),i("li",null,[se,h(n,{variant:"outlined",density:"compact",readonly:!0,modelValue:s.email,"onUpdate:modelValue":e[0]||(e[0]=l=>s.email=l)},null,8,["modelValue"])]),i("li",null,[i("div",te,_(s.viewName),1),h(n,{variant:"outlined",density:"compact",rules:[!!s.name||s.viewName+"을 입력하세요"],placeholder:s.viewName+"을 입력하세요",modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=l=>s.name=l)},null,8,["rules","placeholder","modelValue"])]),i("li",null,[i("div",le,_(s.viewPcs),1),i("div",ie,[h(n,{variant:"outlined",density:"compact",rules:[a.pcsErrors],placeholder:"'-'없이 숫자로만 입력하세요",modelValue:s.pcs,"onUpdate:modelValue":e[2]||(e[2]=l=>s.pcs=l)},null,8,["rules","modelValue"]),s.pcs&&s.pcs!=s.orgPcs?(r(),N(m,{key:0,type:"button",variant:"outlined",class:"pscSendButton",onClick:e[3]||(e[3]=l=>a.sendAuthNum())},{default:v(()=>[oe]),_:1})):p("",!0)])]),s.pcs&&s.pcs!=s.orgPcs?(r(),u("li",re,[i("div",ae,[I("인증번호 "),s.sendAuthFlag?(r(),u("span",ne,[I(" (남은시간: "+_(s.authTimer)+") ",1),i("span",{onClick:e[4]||(e[4]=l=>a.sendAuthNum())},"재요청")])):p("",!0)]),i("div",ue,[h(n,{variant:"outlined",density:"compact",rules:[a.authNumErrors],placeholder:"인증번호를 입력하세요",modelValue:s.authNum,"onUpdate:modelValue":e[5]||(e[5]=l=>s.authNum=l)},null,8,["rules","modelValue"]),h(m,{type:"button",variant:"outlined",color:"blue",class:"pscSendButton",onClick:e[6]||(e[6]=l=>a.checkAuthNum())},{default:v(()=>[ce]),_:1})])])):p("",!0),s.snsType?p("",!0):(r(),u("li",me,[he,h(n,{type:"password",variant:"outlined",modelValue:s.upass,"onUpdate:modelValue":e[7]||(e[7]=l=>s.upass=l),autocomplete:"on",rules:[a.upassErrors],density:"compact",placeholder:"새 비밀번호를 입력해주세요"},null,8,["modelValue","rules"])])),s.upass?(r(),u("li",de,[pe,h(n,{type:"password",variant:"outlined",modelValue:s.reUpass,"onUpdate:modelValue":e[8]||(e[8]=l=>s.reUpass=l),rules:[a.reUpassErrors],autocomplete:"on",density:"compact",placeholder:"새 비밀번호를 다시 입력해주세요"},null,8,["modelValue","rules"])])):p("",!0),s.upass&&!s.snsType?(r(),u("li",_e,[ge,h(n,{type:"password",variant:"outlined",modelValue:s.nowupass,"onUpdate:modelValue":e[9]||(e[9]=l=>s.nowupass=l),autocomplete:"on",rules:[!!s.nowupass||"현재 비밀번호를 입력하세요"],density:"compact",placeholder:"현재 비밀번호를 입력해주세요"},null,8,["modelValue","rules"])])):p("",!0),i("li",null,[fe,i("div",{class:U("user-img "+s.userImgClass)},[s.userImg?(r(),u("img",{key:0,src:s.userImg},null,8,ve)):(r(),u("div",ye,_(s.userFirstName),1))],2),i("input",{style:{display:"none"},type:"file",accept:"image/png, image/jpeg, image/gif",onChange:e[10]||(e[10]=(...l)=>a.uploadActive&&a.uploadActive(...l)),ref:"fileupload"},null,544),h(m,{variant:"outlined",color:"#C3C3C3",onClick:a.imgUpload,class:"img-button"},{default:v(()=>[be]),_:1},8,["onClick"])])]),Ne,i("ul",Ie,[i("li",null,[Ee,i("div",Ue,[i("div",Ve,[s.safariV13?V((r(),u("select",{key:0,"onUpdate:modelValue":e[11]||(e[11]=l=>s.city=l)},[Ae,(r(!0),u(y,null,b(s.citys,l=>(r(),u("option",{value:l},_(l),9,ke))),256))],512)),[[A,s.city]]):(r(),N(k,{key:1,readonly:s.schoolReadOnly,modelValue:s.city,"onUpdate:modelValue":e[12]||(e[12]=l=>s.city=l),variant:"outlined",density:"compact",label:"지역선택",rules:[!!s.city||"지역을 선택하세요"],items:s.citys},null,8,["readonly","modelValue","rules","items"]))]),i("div",Te,[s.safariV13?V((r(),u("select",{key:0,"onUpdate:modelValue":e[13]||(e[13]=l=>s.school=l),readonly:s.schoolReadOnly},[Re,(r(!0),u(y,null,b(s.schools,l=>(r(),u("option",{value:l},_(l),9,Fe))),256))],8,Oe)),[[A,s.school]]):(r(),N(T,{key:1,readonly:s.schoolReadOnly,variant:"outlined",density:"compact",label:"학교명",rules:[!!s.school||"학교명을 입력하세요"],items:s.schools,onClick:a.checkCity,modelValue:s.school,"onUpdate:modelValue":e[14]||(e[14]=l=>s.school=l)},null,8,["readonly","rules","items","onClick","modelValue"]))])])]),i("li",null,[we,i("div",Pe,[i("div",Se,[h(n,{variant:"outlined",density:"compact",label:"학년",rules:[a.checkGrade],modelValue:s.grade,"onUpdate:modelValue":e[15]||(e[15]=l=>s.grade=l)},null,8,["rules","modelValue"])]),i("div",Ce,[h(n,{variant:"outlined",density:"compact",label:"반",rules:[a.checkGclass],modelValue:s.gclass,"onUpdate:modelValue":e[16]||(e[16]=l=>s.gclass=l)},null,8,["rules","modelValue"])])])]),s.role=="ROLE_MANAGER"?(r(),u("li",Me,[Le,i("div",xe,[i("div",Be,[h(n,{variant:"outlined",density:"compact",label:"연락처",rules:[l=>!!l||"연락처를 입력하세요"],modelValue:s.oPcs,"onUpdate:modelValue":e[17]||(e[17]=l=>s.oPcs=l)},null,8,["rules","modelValue"])]),i("div",Ge,[h(n,{variant:"outlined",density:"compact",label:"이름",rules:[l=>!!l||"이름을 입력하세요"],modelValue:s.oUserName,"onUpdate:modelValue":e[18]||(e[18]=l=>s.oUserName=l)},null,8,["rules","modelValue"])])])])):p("",!0),s.role=="ROLE_MEMBER"?(r(),u("li",De,[je,h(n,{variant:"outlined",density:"compact",rules:[!!s.teacherName||"담임 선생님 이름을 입력하세요"],modelValue:s.teacherName,"onUpdate:modelValue":e[19]||(e[19]=l=>s.teacherName=l)},null,8,["rules","modelValue"])])):p("",!0)]),i("div",He,[h(m,{type:"submit",class:"blackButton"},{default:v(()=>[I(" 계정정보 변경 ")]),_:1})])]),_:1},8,["modelValue","onSubmit"])])])}const qe=B(H,[["render",Je],["__scopeId","data-v-2fcb6e95"]]);export{qe as default};
