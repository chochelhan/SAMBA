import{r as K,u as S}from"./xlsx-04f2268f.js";import{a as b,E as A,F as I}from"./urls-dc95fcef.js";import{s as y}from"./realTimeEdu-31352dc5.js";import{_ as F,r as v,o as f,c as p,a,e as d,w as _,i as P,h as m,F as g,b as D,t as C,p as V,g as N}from"./index-e96a63ea.js";import"./axios-c24e582b.js";import"./apiService-77935b08.js";import"./urls-04ad3523.js";import"./auth-eef4144a.js";const O={data(){return{serverFlag:!1,form:null,keyword:"",keywords:[],activeKeywords:[],orgActiveKeywords:[],disabled:!0}},created(){y.ws||y.init(),this.getData()},methods:{getData(){this.activeKeywords=[],this.keywords=[],b.post(A,{},e=>{if(e.data){const t=JSON.parse(e.data);for(const r of t)r.status=="active"?(this.activeKeywords.push(r.word),this.orgActiveKeywords.push(r.word)):this.keywords.push(r.word);this.checkDisabled()}})},excelUpload(){this.$refs.excelFile.click()},async uploadActive(e){const r=await e.target.files[0].arrayBuffer();try{const o=K(r),l=o.Sheets[o.SheetNames[0]],i=S.sheet_to_json(l),c=[],h={};for(const s of i)for(const n in s)h[s[n]]||c.push(s[n]),h[s[n]]=s[n];const w=this.getDoubleKeywordCheck();let u=!1;for(const s of c)w[s]||(u=!0,this.keywords.push(s));if(u)this.updateProhibit("save");else{const s="중복된 단어 때문에 금지어를 등록할수가 없습니다";this.emitter.emit("modalOpen",{message:s})}this.checkDisabled(),this.$refs.excelFile.value=""}catch(o){console.log(o),this.emitter.emit("modalOpen",{message:"잘못된 형식의 엑셀 파일입니다"})}},validate(){if(!this.form)return;const e=this.keyword.split(","),t=this.getDoubleKeywordCheck();let r=!1;for(const o of e)t[o]||(r=!0,this.keywords.push(o));if(r)this.updateProhibit("save");else{const o="중복된 단어 때문에 금지어를 등록할수가 없습니다";this.emitter.emit("modalOpen",{message:o})}this.checkDisabled(),this.$refs.vform.reset()},checkDisabled(){let e=!0;this.keywords.length>0&&(e=!1),e&&this.activeKeywords.length<this.orgActiveKeywords.length&&(e=!1),this.disabled=e},getDoubleKeywordCheck(){const e={};for(const t of this.keywords)e[t]=t;for(const t of this.activeKeywords)e[t]=t;return e},activeWordDelete(e){this.activeKeywords.splice(e,1),this.checkDisabled()},wordDelete(e){this.keywords.splice(e,1),this.checkDisabled()},prohibitActive(){this.updateProhibit("run")},updateProhibit(e){if(this.disabled||this.serverFlag)return;const t=[];for(const o of this.keywords)e=="run"?t.push({word:o,status:"active"}):t.push({word:o,status:"ready"});for(const o of this.activeKeywords)t.push({word:o,status:"active"});const r={keywords:JSON.stringify(t)};this.emitter.emit("overlay","open"),this.serverFlag=!0,b.post(I,r,o=>{this.serverFlag=!1,this.emitter.emit("overlay","hide");let l=o.status,i={};if(l=="success"){let c="금지어 정보가 등록되었습니다";e=="run"&&(y.adminSend({event:"prohibitRun"}),c="금지어 정보가 적용되었습니다"),i={message:c},e=="run"&&this.getData()}else i={message:"잘못된 접근입니다"};this.emitter.emit("modalOpen",i)})}}},k=e=>(V("data-v-9f061f12"),e=e(),N(),e),U={class:"login-container"},B={class:"login-container-inner"},E=k(()=>a("div",{class:"sub-title"},"금지어 등록",-1)),T={class:"input-ul"},M=k(()=>a("li",{class:"label"},"금지어",-1)),R={class:"button-row"},W={class:"sub-title"},H=k(()=>a("span",null,"적용",-1)),J={class:"prohibit-area"},j={class:"prohibit-list"},G={class:"active-prohibit-list"};function L(e,t,r,o,l,i){const c=v("v-text-field"),h=v("v-btn"),w=v("v-form"),u=v("font-awesome-icon");return f(),p("div",U,[a("div",B,[E,d(w,{modelValue:l.form,"onUpdate:modelValue":t[1]||(t[1]=s=>l.form=s),ref:"vform",novalidate:"",onSubmit:P(i.validate,["prevent"])},{default:_(()=>[a("ul",T,[M,a("li",null,[d(c,{variant:"outlined",density:"compact",rules:[s=>!!s||"금지어를 입력하세요"],modelValue:l.keyword,"onUpdate:modelValue":t[0]||(t[0]=s=>l.keyword=s)},null,8,["rules","modelValue"]),a("div",R,[d(h,{type:"submit",class:"button",color:"black"},{default:_(()=>[m(" 등록 ")]),_:1}),d(h,{type:"button",onClick:i.excelUpload,class:"button",color:"green"},{default:_(()=>[m(" 엑셀등록 ")]),_:1},8,["onClick"])])])])]),_:1},8,["modelValue","onSubmit"]),a("input",{type:"file",onChange:t[2]||(t[2]=(...s)=>i.uploadActive&&i.uploadActive(...s)),ref:"excelFile",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",style:{display:"none"}},null,544),a("div",W,[m(" 금지어 목록 "),d(h,{type:"button",onClick:t[3]||(t[3]=s=>i.prohibitActive()),class:"active-button",disabled:l.disabled},{default:_(()=>[H]),_:1},8,["disabled"])]),a("div",J,[a("div",j,[(f(!0),p(g,null,D(l.keywords,(s,n)=>(f(),p("span",null,[m(C(s)+" ",1),d(u,{class:"icon",onClick:x=>i.wordDelete(n),icon:"fa-solid fa-xmark"},null,8,["onClick"])]))),256))]),a("div",G,[(f(!0),p(g,null,D(l.activeKeywords,(s,n)=>(f(),p("span",null,[m(C(s)+" ",1),d(u,{class:"icon",onClick:x=>i.activeWordDelete(n),icon:"fa-solid fa-xmark"},null,8,["onClick"])]))),256))])])])])}const te=F(O,[["render",L],["__scopeId","data-v-9f061f12"]]);export{te as default};
