import{M as i}from"./index-e96a63ea.js";import{a as n}from"./apiService-77935b08.js";import{a0 as o}from"./urls-04ad3523.js";import{A as d}from"./auth-eef4144a.js";const a=i("webSocket",{state:()=>({loginSocketData:{},logoutSocketData:{},adminSendData:{},myStudentsData:{},eduSocketData:{},studentSocketData:{},eduIngMemberSocketData:{},eduIngHostSocketData:{},receiveTargetData:{},prohibitList:{}}),actions:{response(t){switch(console.log(t),t.type){case"loginCheck":case"reLogin":this.loginSocketData={type:t.type,result:t.result,time:new Date().toLocaleString()};break;case"forceLogout":this.logoutSocketData={logoutType:t.logoutType,time:new Date().toLocaleString()};break;case"startEdu":this.eduSocketData={hostName:t.hostName,eduId:t.eduId,time:new Date().toLocaleString()};break;case"startEduWithStudents":case"eduStudyStudents":this.studentSocketData={students:t.students,time:new Date().toLocaleString()};break;case"closeEdu":case"forceEduEnd":this.eduIngMemberSocketData={type:t.type,time:new Date().toLocaleString()};break;case"studentEnd":case"forceStudentEnd":this.eduIngHostSocketData={type:t.type,endUid:t.endUid,time:new Date().toLocaleString()};break;case"userComplete":this.eduIngHostSocketData={type:t.type,uid:t.uid,time:new Date().toLocaleString()};break;case"userClose":case"login":case"getOnlineStudents":this.myStudentsData={students:t.students,time:new Date().toLocaleString()};break;case"eduIng":this.eduIngMemberSocketData={type:t.type,eduId:t.eduId,time:new Date().toLocaleString()};break;case"sendTarget":this.receiveTargetData=t;break;case"admin":this.adminSendData=t;break;case"refreshLogin":n.post(o,{},e=>{e.status=="success"&&(d.setSession(e),r.close())});break}},setProhibits(t){this.prohibitList=t}},getters:{getLoginSocketData(t){return t.loginSocketData},getLogoutSocketData(t){return t.logoutSocketData},getEduSocketData(t){return t.eduSocketData},getStudentSocketData(t){return t.studentSocketData},getEduIngMemberSocketData(t){return t.eduIngMemberSocketData},getEduIngHostSocketData(t){return t.eduIngHostSocketData},getMyStudentsData(t){return t.myStudentsData}}}),r={ws:null,uid:null,role:null,name:null,eduId:null,userParams:{},init(){const t=location.protocol=="http:"?"ws":"wss";this.ws=new WebSocket(t+"://"+location.host+"/realTimeEdu"),this.ws.onmessage=function(e){const s=JSON.parse(e.data);a().response(s)},this.ws.onclose=()=>{this.init(),this.uid&&this.setForceSession(this.userParams)}},adminSend(t){t.type="admin";const e=JSON.stringify(t);this.ws.send(e)},setUid(t){if(!this.uid)if(this.uid=t.uid,this.role=t.role,this.name=t.name,this.userParams=t,this.ws.readyState==1)this.setUidAction(t,"login");else{const e=setInterval(()=>{this.ws.readyState==1&&(this.setUidAction(t,"login"),clearInterval(e))},100)}},setUidAction(t,e){const s={type:e,uid:t.uid,role:t.role,name:t.name,schoolId:"sdsd",grade:"1",gclass:"rd"};this.send(s)},setForceSession(t){if(this.ws.readyState==1)this.setUidAction(t,"forceSetSession"),console.log("--------- schedule force start ---------");else{const e=setInterval(()=>{this.ws.readyState==1&&(this.setUidAction(t,"forceSetSession"),clearInterval(e))},100)}},loginCheck(t){if(this.uid||!this.ws)return;const e={type:"loginCheck",uid:t};this.send(e)},reLogin(t){if(this.uid||!this.ws)return;const e={type:"reLogin",uid:t};this.send(e)},getOnlineStudents(t){if(!this.ws||!this.uid){const e=setInterval(()=>{this.ws&&this.uid&&(this.getMyStudents(t),clearInterval(e))},300)}else this.getMyStudents(t)},getMyStudents(t){const e={type:"getOnlineStudents",uid:this.uid,gclass:t.gclass.toString(),grade:t.grade.toString(),schoolId:t.schoolId.toString()};this.send(e)},send(t){if(this.ws.readyState==1){const e=JSON.stringify(t);this.ws.send(e)}else{const e=setInterval(()=>{if(this.ws.readyState==1){const s=JSON.stringify(t);this.ws.send(s),clearInterval(e)}},300)}},userComplete(t){if(!this.ws||!this.uid)return;const e={type:"userComplete",eduId:t,uid:this.uid};this.send(e)},startEdu(t,e){if(!this.ws||this.eduId)return;this.eduId=t;const s={type:"startEdu",eduId:this.eduId,uid:this.uid,selectedStudents:e};this.send(s)},closeEdu(){if(!this.ws||!this.eduId)return;const t={type:"closeEdu",uid:this.uid,eduId:this.eduId};this.send(t)},rejoinEdu(t){if(!this.ws||this.eduId)return;this.eduId=t;const e={type:"rejoinEdu",uid:this.uid,eduId:this.eduId};this.send(e)},sendTarget(t){if(!this.ws)return;const e={type:"sendTarget",event:t.event,data:t.data,targetUid:t.targetUid};this.send(e)},close(){this.ws.close()}};export{r as s,a as w};
