import{s as b,w as x}from"./realTimeEdu-31352dc5.js";import{a as m}from"./apiService-77935b08.js";import{i as B,j as L}from"./urls-04ad3523.js";import{A as D}from"./auth-eef4144a.js";import{_ as E,m as U,r as C,o as l,c,a as e,h as p,t as a,F as f,b as y,n as h,j as T,w as A,d as g,p as k,g as I}from"./index-e96a63ea.js";import{U as S}from"./util-75dcb7cf.js";import"./axios-c24e582b.js";const V={computed:{...U(x,["myStudentsData"])},watch:{myStudentsData(s){this.setOnlineStudents(s)}},data(){return{payUseType:"",userList:{},serverFlag:!1,pcView:!0,connectCount:0,totalCount:0,authTotal:0,paySetting:{}}},created(){const s=D.getSession();if(!s||s.memberInfo.role=="ROLE_MEMBER"){location.href="/";return}window.document.body.clientWidth<=1023&&(this.pcView=!1),this.role=s.memberInfo.role,b.getOnlineStudents(s.memberInfo),this.getData()},methods:{getData(){m.post(B,{},s=>{this.payUseType=s.payUseType,this.paySetting=s.paySetting[s.payUseType];let u=0,n=1;const o=new Date(S.getStandardNowDate()),i=o.getMonth()+1>9?o.getMonth()+1:"0"+(o.getMonth()+1),d=o.getDate()>9?o.getDate():"0"+o.getDate(),r=o.getFullYear().toString()+i+d;for(let t of s.students){if(t.status="offline",t.statusText="오프라인",t.payUseType=="student")if(t.payEndDate){let _=t.payEndDate.replace("-","").replace("-","");parseInt(r)<parseInt(_)?(t.updButton=!1,t.schoolAuthText="학생 요금제"):(t.updButton=!0,t.schoolAuth="no",t.schoolAuthText="미승인",t.schoolAuthButton="승인처리")}else t.updButton=!1,t.schoolAuthText="학생 요금제";else t.payAuthStatus=="none"?(t.updButton=!0,t.schoolAuth="no",t.schoolAuthText="미승인",t.schoolAuthButton="승인처리"):t.payAuthStatus=="teacher"||t.payAuthStatus=="school"?(t.schoolAuth="yes",t.schoolAuthText="승인",t.schoolAuthButton="승인해제",t.updButton=!0,u++):(t.updButton=!1,t.schoolAuthText="학생 요금제");t.num=n,this.userList[t.uid]=t,this.totalCount=s.students.length,n++}this.authTotal=u,this.myStudentsData.students&&this.setOnlineStudents(this.myStudentsData)})},setOnlineStudents(s){const u={};let n=0;for(const o of s.students)u[o.uid]=o.name,n++;this.connectCount=n;for(let o in this.userList)u[o]?(this.userList[o].status="online",this.userList[o].statusText="접속"):(this.userList[o].status="offline",this.userList[o].statusText="오프라인")},authTeacher(s){if(s.schoolAuth!="yes"&&this.authTotal>=parseInt(this.paySetting.studentLimit)){const n={message:"등록가능한 학생수 "+this.paySetting.studentLimit+"명을 초과 하였습니다.<br>승인처리 된 학생명단을 확인 부탁 드립니다."};this.emitter.emit("modalOpen",n);return}const u={type:"confirm",message:"승인상태를 변경하시겠습니까?",doAction:()=>{this.authTeacherActive(s)}};this.emitter.emit("modalOpen",u)},authTeacherActive(s){const u={id:s.id.toString(),sendType:"student",payAuthStatus:s.payAuthStatus=="none"?this.payUseType:"none"};this.emitter.emit("overlay","open"),m.post(L,u,n=>{this.emitter.emit("overlay","hide");let o="승인상태를 변경하였습니다";n.status=="success"?this.getData():n.code=="over"?o="이미 "+this.paySetting.studentLimit+"명의 학생을 승인하였습니다":n.code=="schoolOver"?o="학교요금제 총 추가인원 ("+S.numberFormat(n.baseLimit)+")을 초과하였습니다":o="학생 요금제를 사용중으로 변경이 불가능합니다";const i={message:o};this.emitter.emit("modalOpen",i)})}},mounted(){window.addEventListener("resize",()=>{window.document.body.clientWidth<=1023?this.pcView=!1:this.pcView=!0})},beforeUnmount(){window.removeEventListener("resize",()=>{window.document.body.clientWidth<=1023?this.pcView=!1:this.pcView=!0})}},v=s=>(k("data-v-30f2247d"),s=s(),I(),s),M={class:"edu-container"},O=v(()=>e("div",{class:"page-title"},"실시간 접속 학생명단",-1)),R={class:"page-user-info"},F={key:0,class:"edu-table",cellspacing:"0",cellpadding:"0",border:"0"},N=v(()=>e("thead",null,[e("tr",null,[e("th",{style:{width:"25%"}},"이름"),e("th",{style:{width:"25%"}},"접속상태"),e("th",{style:{width:"25%"}},"승인상태"),e("th",{style:{width:"25%"}},"승인")])],-1)),j={key:1,class:"edu-ul"},P={class:"subject-box"},Y={class:"subject"},z={class:"date"},H={class:"button-box"};function W(s,u,n,o,i,d){const r=C("v-btn");return l(),c("div",M,[O,e("div",R,[p(" 접속자 "),e("span",null,a(i.connectCount),1),p("명 / 총 학생수 "),e("span",null,a(i.totalCount),1),p("명 / 승인 수 "),e("span",null,a(i.authTotal),1),p("명 ")]),i.pcView?(l(),c("table",F,[N,e("tbody",null,[(l(!0),c(f,null,y(i.userList,(t,_)=>(l(),c("tr",null,[e("td",null,a(t.name)+" ("+a(t.uid)+")",1),e("td",null,[e("div",{class:h(t.status)},a(t.statusText),3)]),e("td",null,[e("div",{class:h(t.schoolAuth)},a(t.schoolAuthText),3)]),e("td",null,[t.updButton?(l(),T(r,{key:0,variant:"outlined",class:h("btn_"+t.schoolAuth),onClick:w=>d.authTeacher(t)},{default:A(()=>[e("span",null,a(t.schoolAuthButton),1)]),_:2},1032,["class","onClick"])):g("",!0)])]))),256))])])):(l(),c("ul",j,[(l(!0),c(f,null,y(i.userList,(t,_)=>(l(),c("li",null,[e("div",P,[e("div",Y,a(t.name)+" ("+a(t.uid)+") ",1),e("div",z,[e("div",{class:h(t.status)},a(t.statusText),3)])]),e("div",H,[e("div",{class:h(t.schoolAuth)},a(t.schoolAuthText),3),t.updButton?(l(),T(r,{key:0,variant:"outlined",class:h("btn_"+t.schoolAuth),onClick:w=>d.authTeacher(t)},{default:A(()=>[e("span",null,a(t.schoolAuthButton),1)]),_:2},1032,["class","onClick"])):g("",!0)])]))),256))]))])}const $=E(V,[["render",W],["__scopeId","data-v-30f2247d"]]);export{$ as default};
